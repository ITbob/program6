<!doctype html>
<meta charset="utf-8">
<title>Program6</title>
<body>

<script src="pixi.js/bin/pixi.js"></script>
<script src="Backend/Model/Item.js"></script>
<script src="Backend/Toolbox/Rectangle.js"></script>
<script src="Backend/Model/Ceil.js"></script>
<script src="Backend/Model/PathFinder/AStarSearch.js"></script>
<script src="Backend/Model/PathFinder/AStarNode.js"></script>
<script src="Backend/Model/Unit.js"></script>
<script src="Backend/Model/AccelerationEffectManager.js"></script>
<script src="Backend/Model/MyMap.js"></script>
<script src="Backend/Toolbox/Keyboardhelper.js"></script>
<script>

//Create a Pixi stage and renderer and add the 
//renderer.view to the DOM
//Aliases
var Container = PIXI.Container,
    autoDetectRenderer = PIXI.autoDetectRenderer,
    loader = PIXI.loader,
    resources = PIXI.loader.resources,
    Sprite = PIXI.Sprite;

//Create a Pixi stage and renderer and add the 
//renderer.view to the DOM
var stage = new Container(),
    renderer = autoDetectRenderer(600, 600);
document.body.appendChild(renderer.view);

//load an image and run the `setup` function when it's done
loader.add("Backend/Images/Program6.json").load(setup);
var map;

var left = Keyboardhelper(37),
    up = Keyboardhelper(38),
    right = Keyboardhelper(39),
    down = Keyboardhelper(40);

//This `setup` function will run when the image has loaded
function setup() {

	id = resources["Backend/Images/Program6.json"].textures;

	map = new MyMap(id);
 	
  	up.press = function() {
      map.MoveY(1);
  	};

    down.press = function() {
      map.MoveY(0);
  	};

    left.press = function() {
    	map.MoveX(1);
  	};

    right.press = function() {
    	map.MoveX(0);
  	};

	stage.addChild(rectangle(0, 0, 600, 600, 0xb5f990, 0x000000, 2));
	

	for (var i = 0; i < map.ceils.length; i++) 
	{
		for(var l = 0; l < map.ceils[i].length; l++)
		{
			stage.addChild(map.ceils[i][l].sprite);
			stage.addChild(map.ceils[i][l].selectedSprite);
			stage.addChild(map.ceils[i][l].pathSprite);
      stage.addChild(map.ceils[i][l].blockedSprite);
		}
	}

  for(var i = 0; i < map.unit.sprites.length; i++)
  {
    stage.addChild(map.unit.sprites[i]);
  }

	//renderer.render(stage);
  var manager = new PIXI.interaction.InteractionManager(renderer);
  manager.on('mousedown', map.MouseDown.bind(map), false);
  window.addEventListener('mousewheel', map.MouseWheel.bind(map), false);


 	gameloop();
}

function gameloop(){

	requestAnimationFrame(gameloop);

	//Update the current game state
  //state();
  
  map.unit.Update();
  map.Update();

	renderer.render(stage);
}

</script>
</body>
